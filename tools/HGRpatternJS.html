<!--
//
// Copyright (c) 2022 Freddy Vandriessche.
// notice: https://raw.githubusercontent.com/RetroAppleJS/AppleII-IDE/main/LICENSE.md
//
// HGRpatternJS.html

ASCII ART
https://patorjk.com/software/taag/#p=display&c=c%2B%2B&f=ANSI%20Regular
https://patorjk.com/software/taag/#p=display&c=c%2B%2B&f=Varsity
-->

<html style="background-color:#B0B0B0">
  <head>
    <script type="text/javascript" src="../res/COM_MAIN.js"></script>
  <script type="text/javascript" src="../res/EMU_apple2video.js"></script>
  <script type="text/javascript" src="../res/EMU_apple2hw.js"></script>
  <script type="text/javascript" src="../res/EMU_apple2io.js"></script>
  <script type="text/javascript" src="../res/HGRpalette.js"></script>
  <script type="text/javascript" src="../res/HGRpattern.js"></script>
  <script type="text/javascript" src="../res/rhill-voronoi-core.js"></script>

<script>
//   ____  ____   ______  _______                    _     _                              _____   ______   
//  |_   ||   _|.' ___  ||_   __ \                  / |_  / |_                           |_   _|.' ____ \  
//    | |__| | / .'   \_|  | |__) |  _ .--.   ,--. `| |-'`| |-'.---.  _ .--.  _ .--.       | |  | (___ \_| 
//    |  __  | | |   ____  |  __ /  [ '/'`\ \`'_\ : | |   | | / /__\\[ `/'`\][ `.-. |  _   | |   _.____`.  
//   _| |  | |_\ `.___]  |_| |  \ \_ | \__/ |// | |,| |,  | |,| \__., | |     | | | | | |__' |  | \____) | 
//  |____||____|`._____.'|____| |___|| ;.__/ \'-;__/\__/  \__/ '.__.'[___]   [___||__]`.____.'   \______.' 
//                                  [__|                                                                    

//  ██ ███    ██ ██ ████████ 
//  ██ ████   ██ ██    ██    
//  ██ ██ ██  ██ ██    ██    
//  ██ ██  ██ ██ ██    ██    
//  ██ ██   ████ ██    ██

var _D = 
{
     "blc":[10,10]       // pattern matrix
    ,"bls":[17,8]        // pattern sample size
    ,"opat":0            // pattern index offset
    ,"prep":4            // horizontal pattern repetition (bits)
    ,"filterExcl":["DOUBL","SAT","VPAT","GREY","PROX"]     // remove excluded patterns
    ,"topheight":220     // height of top pane (rainbow)
    ,"leftpane":430      // width of left pane (grid)
    ,"rightpane":560     // width of right pane (HGR screen)
    ,"bmapID":0          // location of editable grid
    ,"YVERTL":"0000000000000000"+"8080808080808080"+"0000000000000000"+"8080808080808080"+"0000000000000000"+"8080808080808080"+"0000000000000000"+"8080808080808080"
              +"2828282828282828"+"A8A8A8A8A8A8A8A8"+"2828282828282828"+"A8A8A8A8A8A8A8A8"+"2828282828282828"+"A8A8A8A8A8A8A8A8"+"2828282828282828"+"A8A8A8A8A8A8A8A8"
              +"5050505050505050"+"D0D0D0D0D0D0D0D0"+"5050505050505050"+"D0D0D0D0D0D0D0D0"+"5050505050505050"+"D0D0D0D0D0D0D0D0"+"5050505050505050"+"D0D0D0D0D0D0D0D0"
    ,"YVERTH":"2024282C3034383C"+"2024282C3034383C"+"2125292D3135393D"+"2125292D3135393D"+"22262A2E32363A3E"+"22262A2E32363A3E"+"23272B2F33373B3F"+"23272B2F33373B3F"
              +"2024282C3034383C"+"2024282C3034383C"+"2125292D3135393D"+"2125292D3135393D"+"22262A2E32363A3E"+"22262A2E32363A3E"+"23272B2F33373B3F"+"23272B2F33373B3F"
              +"2024282C3034383C"+"2024282C3034383C"+"2125292D3135393D"+"2125292D3135393D"+"22262A2E32363A3E"+"22262A2E32363A3E"+"23272B2F33373B3F"+"23272B2F33373B3F"
}
const _CFG_CHROMA = {
 0:{"COL_num":"" ,"COL_name":"FULL-COLOR"}
,1:{"COL_num":"#FFFFFF" ,"COL_name":"B&W"}
,2:{"COL_num":"#A0FFF0" ,"COL_name":"GREEN"}
,3:{"COL_num":"#FCE7A1" ,"COL_name":"AMBER"}
}
var yref = new Array();
for(var i=0;i<_D.YVERTL.length;i+=2)
  yref[i/2] = parseInt( _D.YVERTH.substring(i,i+2),16)*256
              +parseInt( _D.YVERTL.substring(i,i+2),16);

var oEMU = {"component":"Video"};
var oPATTERN = new PATTERN();
var oPALETTE = new PALETTE();
oPALETTE.bProgressbar = true;
oPALETTE.progress_bar = function(pct)
{
  if(pct == 0)
  {
      this.progress_time = new Date();
      document.getElementById("hourglass").innerHTML = 
      "<img src=../res/Apple_first_logo.png style='position:absolute;left:0px;top:0px'>"
      +"<img id=newton src=../res/apple-logo-1977.png style='position:absolute;left:128px;top:196px;width:20px;height;20px;image-rendering:pixelated'>"
  }
  else
      document.getElementById("newton").style.top = (196+pct*pct*0.0062)+"px";
      document.getElementById("newton").style.transform = "rotate("+(2.5*pct)+"deg)";

  var d = new Date();
  //console.log("pct="+pct+" "+(d-this.progress_time)+"ms");
}


var custom_bmap,custom_fmla;
var vidContext, apple2plus;
var status_message = function(str) { document.getElementById("status").innerHTML = "<small>"+str+"</small>"  }



//   ██████  ███    ██ ██       ██████   █████  ██████  
//  ██    ██ ████   ██ ██      ██    ██ ██   ██ ██   ██ 
//  ██    ██ ██ ██  ██ ██      ██    ██ ███████ ██   ██ 
//  ██    ██ ██  ██ ██ ██      ██    ██ ██   ██ ██   ██ 
//   ██████  ██   ████ ███████  ██████  ██   ██ ██████


function init_gui(bRefresh)
{
  
  status_message("init");

  try{ document.getElementById('slider_title').outerHTML = _TITLE() } catch(e){}  
  if(!bRefresh)
  {
    vidContext          = document.getElementById('applescreen').getContext("2d");
    apple2plus          = new Apple2Plus(vidContext);
    document.getElementById('applescreen').style.margin = (_D.topheight+1)+"px 0px 0px 0px";
    apple2plus.video.setCol(3,0, "#FF00FF");    // tweak purple value (#D043E5)
    apple2plus.video.setCol(6,0, "#0080FF");    // tweak blue value   (#2F95FF)
    apple2plus.video.setCol(9,0, "#FF8000");    // tweak orange value (#D06A1A)
    apple2plus.video.setCol(12,0,"#80FF80");    // tweak green value  (#2FBC1A)
  }


  //document.getElementById('greyPalette').style.margin = (_D.topheight+1)+"px 0px 0px 0px";

  //   _______     _     _________  _________  ________  _______     ____  _____  
  //  |_   __ \   / \   |  _   _  ||  _   _  ||_   __  ||_   __ \   |_   \|_   _| 
  //    | |__) | / _ \  |_/ | | \_||_/ | | \_|  | |_ \_|  | |__) |    |   \ | |   
  //    |  ___/ / ___ \     | |        | |      |  _| _   |  __ /     | |\ \| |   
  //   _| |_  _/ /   \ \_  _| |_      _| |_    _| |__/ | _| |  \ \_  _| |_\   |_  
  //  |_____||____| |____||_____|    |_____|  |________||____| |___||_____|\____| 

  oPATTERN.colorFN = apple2plus.video.hgr_PixelColor;
  oPATTERN.set_prep(bRefresh?oPATTERN.prep:_D.prep);

  oPATTERN.criteria_desc = {
   "DOUBL":"copy of "
  ,"SAT":"pale blend"
  ,"VPAT":"hard vertical lines"
  ,"PROX":"adjoining "}
  switch(oPATTERN.prep)
  {
    case 4:
    oPATTERN.criteria = {0:{"GREY":-1},3:{"GREY":-1},6:{"GREY":-1},9:{"PROX":3},11:{"SAT":-1},12:{"GREY":-1},13:{"PROX":7},14:{"PROX":11},15:{"GREY":-1},17:{"VPAT":-1},18:{"SAT":-1},19:{"VPAT":-1},20:{"VPAT":-1},24:{"SAT":-1},25:{"PROX":22},26:{"SAT":-1},27:{"SAT":-1},29:{"PROX":23},30:{"SAT":-1},33:{"SAT":-1},34:{"VPAT":-1},35:{"PROX":41},36:{"SAT":-1},37:{"PROX":21},38:{"PROX":41},39:{"SAT":-1},41:{"SAT":-1},44:{"PROX":41},45:{"SAT":-1},46:{"PROX":43},47:{"PROX":43},48:{"GREY":-1},50:{"PROX":41},51:{"VPAT":-1},54:{"VPAT":-1},55:{"VPAT":-1},56:{"PROX":41},57:{"VPAT":-1},59:{"VPAT":-1},60:{"GREY":-1},62:{"SAT":-1},63:{"VPAT":-1},66:{"SAT":-1},72:{"SAT":-1},73:{"PROX":22},75:{"SAT":-1},77:{"PROX":23},78:{"SAT":-1},82:{"PROX":5},88:{"PROX":5},89:{"PROX":53},90:{"DOUBL":165},91:{"PROX":87},93:{"PROX":87},94:{"PROX":87},96:{"GREY":-1},98:{"PROX":41},99:{"VPAT":-1}
    ,102:{"VPAT":-1},103:{"VPAT":-1},104:{"PROX":41},105:{"GREY":-1},107:{"PROX":62},108:{"VPAT":-1},110:{"VPAT":-1},114:{"SAT":-1},111:{"VPAT":-1},115:{"VPAT":-1},118:{"VPAT":-1},119:{"VPAT":-1},120:{"SAT":-1},122:{"PROX":175},124:{"PROX":61},126:{"PROX":-1},129:{"SAT":-1},132:{"SAT":-1},133:{"PROX":5},131:{"PROX":41},134:{"PROX":41},135:{"SAT":-1},136:{"VPAT":-1},137:{"PROX":176},140:{"PROX":41},141:{"SAT":-1},142:{"PROX":43},143:{"PROX":43},144:{"PROX":3},145:{"PROX":22},147:{"VPAT":-1},148:{"PROX":22},149:{"PROX":53},150:{"GREY":-1},153:{"VPAT":-1},154:{"PROX":58},155:{"VPAT":-1},156:{"VPAT":-1},157:{"VPAT":-1},158:{"PROX":62},159:{"VPAT":-1},167:{"PROX":175},169:{"PROX":58},173:{"PROX":122},174:{"PROX":-1},176:{"PROX":146},177:{"SAT":-1},179:{"VPAT":-1},180:{"SAT":-1},182:{"PROX":62},185:{"VPAT":-1},186:{"PROX":-1},187:{"VPAT":-1},188:{"PROX":62},189:{"PROX":-1},192:{"GREY":-1},194:{"PROX":41},195:{"GREY":-1},198:{"VPAT":-1},199:{"PROX":61}
    ,200:{"PROX":41},201:{"VPAT":-1},203:{"PROX":62},204:{"VPAT":-1},206:{"VPAT":-1},207:{"VPAT":-1},208:{"PROX":7},209:{"PROX":23},210:{"SAT":-1},212:{"PROX":23},213:{"PROX":87},216:{"SAT":-1},217:{"VPAT":-1},218:{"PROX":122},219:{"PROX":123},221:{"VPAT":-1},222:{"SAT":-1},223:{"PROX":127},224:{"PROX":11},225:{"SAT":-1},226:{"PROX":43},227:{"SAT":-1},228:{"SAT":-1},229:{"PROX":181},230:{"SAT":-1},231:{"SAT":-1},232:{"PROX":43},233:{"PROX":182},234:{"PROX":-1},236:{"VPAT":-1},237:{"PROX":123},238:{"VPAT":-1},239:{"PROX":191},240:{"GREY":-1},242:{"PROX":43},243:{"VPAT":-1},246:{"VPAT":-1},248:{"PROX":43},249:{"VPAT":-1},252:{"VPAT":-1},253:{"PROX":127},254:{"PROX":191},255:{"GREY":-1},256:{"GREY":-1},259:{"GREY":-1},262:{"GREY":-1},263:{"SAT":-1},265:{"PROX":3},268:{"GREY":-1},269:{"PROX":263},270:{"PROX":267},271:{"GREY":-1},273:{"VPAT":-1},280:{"VPAT":-1},281:{"PROX":25},283:{"SAT":-1},285:{"PROX":279},286:{"SAT":-1},290:{"VPAT":-1},291:{"PROX":41},294:{"PROX":41},295:{"PROX":301},297:{"PROX":41}
    ,300:{"PROX":41},301:{"SAT":-1},302:{"PROX":299},303:{"PROX":43},304:{"GREY":-1},305:{"PROX":404},306:{"PROX":658},307:{"VPAT":-1},308:{"SAT":-1},310:{"GREY":-1},311:{"VPAT":-1},313:{"VPAT":-1},315:{"VPAT":-1},316:{"GREY":-1},318:{"SAT":-1},319:{"VPAT":-1},329:{"PROX":22},331:{"SAT":-1},333:{"PROX":279},334:{"SAT":-1},343:{"PROX":349},345:{"PROXY":53},350:{"PROX":347},351:{"PROX":105},352:{"GREY":-1},355:{"VPAT":-1},358:{"VPAT":-1},359:{"VPAT":-1},361:{"PROX":105},363:{"VPAT":-1},364:{"GREY":-1},366:{"SAT":-1},367:{"VPAT":-1},370:{"SAT":-1},371:{"VPAT":-1},374:{"VPAT":-1},375:{"VPAT":-1},376:{"SAT":-1},377:{"PROX":61},379:{"VPAT":-1},380:{"PROX":61},387:{"PROX":41},389:{"SAT":-1},390:{"PROX":41},391:{"SAT":-1},392:{"VPAT":-1},393:{"PROX":35},396:{"PROX":41},397:{"SAT":-1},398:{"PROX":299},399:{"PROX":43}
    ,400:{"PROX":3},401:{"PROX":305},402:{"PROX":306},403:{"VPAT":-1},405:{"PROX":309},404:{"PROX":308},406:{"PROX":105},407:{"PROX":317},408:{"PROX":306},409:{"VPAT":-1},410:{"PROX":314},411:{"VPAT":-1},412:{"GREY":-1},413:{"VPAT":-1},414:{"PROX":318},415:{"VPAT":-1},425:{"PROX":58},429:{"PROX":423},430:{"PROX":427},432:{"PROX":146},433:{"SAT":-1},435:{"VPAT":-1},437:{"PROX":501},438:{"PROX":62},441:{"VPAT":-1},442:{"PROX":506},443:{"PROX":446},444:{"PROX":62},445:{"PROX":439},448:{"GREY":-1},451:{"GREY":-1},454:{"VPAT":-1},455:{"PROX":317},457:{"VPAT":-1},459:{"PROX":318},460:{"VPAT":-1},461:{"VPAT":-1},462:{"VPAT":-1},463:{"VPAT":-1},464:{"PROX":7},465:{"PROX":279},468:{"PROX":279},469:{"PROX":373},471:{"PROX":381},473:{"VPAT":-1},474:{"PROX":378},475:{"PROX":382},477:{"VPAT":-1},478:{"PROX":478},479:{"PROX":127},480:{"PROX":11},481:{"PROX":391},485:{"PROX":437},486:{"VPAT":-1},487:{"PROX":439},489:{"PROX":62},490:{"PROX":442},491:{"PROX":446},492:{"VPAT":-1},493:{"PROX":439},494:{"PROX":491},495:{"PROX":191},496:{"GREY":-1},497:{"SAT":-1},498:{"SAT":-1},499:{"VPAT":-1}
    ,500:{"SAT":-1},502:{"VPAT":-1},503:{"DOUBL":639},504:{"SAT":-1},505:{"VPAT":-1},506:{"DOUBL":687},507:{"DOUBL":703},508:{"VPAT":-1},509:{"PROX":503},510:{"DOUBL":703},511:{"GREY":-1},512:{"PROX":3},515:{"GREY":-1},518:{"GREY":-1},521:{"GREY":-1},524:{"GREY":-1},525:{"PROX":263},526:{"PROX":267},527:{"GREY":-1},529:{"VPAT":-1},530:{"SAT":-1},536:{"SAT":-1},537:{"PROX":308},538:{"SAT":-1},539:{"SAT":-1},541:{"PROX":535},542:{"PROX":539},545:{"SAT":-1},546:{"VPAT":-1},547:{"VPAT":-1},548:{"SAT":-1},549:{"SAT":-1},551:{"SAT":-1},553:{"PROX":402},557:{"PROX":542},558:{"PROX":555},559:{"SAT":-1},560:{"GREY":-1},563:{"VPAT":-1},566:{"VPAT":-1},567:{"VPAT":-1},569:{"VPAT":-1},571:{"VPAT":-1},572:{"GREY":-1},574:{"SAT":-1},575:{"VPAT":-1},578:{"SAT":-1},584:{"SAT":-1},585:{"PROX":308},587:{"SAT":-1},589:{"PROX":535},590:{"PROX":539},594:{"PROX":293}
    ,600:{"PROX":293},601:{"PROX":309},602:{"SAT":-1},603:{"PROX":373},605:{"PROX":599},606:{"DOUBL":693},608:{"GREY":-1},611:{"VPAT":-1},614:{"VPAT":-1},615:{"VPAT":-1},617:{"PROX":105},619:{"PROX":318},620:{"VPAT":-1},622:{"VPAT":-1},623:{"VPAT":-1},626:{"SAT":-1},627:{"VPAT":-1},630:{"VPAT":-1},631:{"VPAT":-1},632:{"SAT":-1},635:{"SAT":-1},636:{"PROX":317},638:{"PROX":635},641:{"SAT":-1},644:{"SAT":-1},645:{"PROX":293},647:{"SAT":-1},648:{"SAT":-1},649:{"PROX":306},653:{"PROX":539},654:{"PROX":555},655:{"SAT":-1},656:{"PROX":3},657:{"PROX":308},658:{"PROX":312},659:{"VPAT":-1},660:{"PROX":308},661:{"PROX":309},662:{"PROX":105},664:{"PROX":312},665:{"VPAT":-1},666:{"PROX":314},667:{"VPAT":-1},668:{"VPAT":-1},669:{"VPAT":-1},670:{"PROX":318},671:{"VPAT":-1},677:{"SAT":-1},681:{"PROX":314},685:{"PROX":634},686:{"PROX":683},689:{"SAT":-1},691:{"VPAT":-1},692:{"SAT":-1},694:{"PROX":318},695:{"SAT":-1},697:{"VPAT":-1},699:{"VPAT":-1}
    ,700:{"PROX":318},701:{"PROX":635},704:{"GREY":-1},707:{"GREY":-1},710:{"VPAT":-1},711:{"PROX":317},713:{"VPAT":-1},715:{"PROX":318},716:{"VPAT":-1},717:{"VPAT":-1},718:{"VPAT":-1},719:{"VPAT":-1},720:{"PROX":263},721:{"PROX":535},722:{"SAT":-1},724:{"PROX":535},725:{"PROX":599},728:{"SAT":-1},729:{"VPAT":-1},730:{"PROX":634},731:{"PROX":635},732:{"VPAT":-1},733:{"VPAT":-1},734:{"PROX":635},735:{"PROX":503},736:{"PROX":267},737:{"PROX":653},738:{"PROX":555},739:{"SAT":-1},740:{"PROX":653},741:{"PROX":603},742:{"VPAT":-1},743:{"PROX":701},744:{"PROX":555},745:{"PROX":459},746:{"PROX":683},748:{"VPAT":-1},749:{"PROX":701},750:{"VPAT":-1},751:{"PROX":507},752:{"GREY":-1},754:{"SAT":-1},755:{"VPAT":-1},758:{"VPAT":-1},760:{"SAT":-1},761:{"VPAT":-1},764:{"VPAT":-1},765:{"PROX":503},766:{"PROX":507},767:{"GREY":-1}}
    break;
    default:
    oPATTERN.criteria = {};
  }  

  oPATTERN.add_criteria(apple2plus.video.hgr_PixelColor)
  oPATTERN.filterExcl = _D.filterExcl;

  /*
  custom_bmap =  new Array(oPATTERN.bmapx).fill([false,0]).map(() => new Array(oPATTERN.bmapy).fill([false,0]));
  custom_fmla = ["",""];
  var a = oPATTERN.parse();
  var s = "", sep = " ; ";
  for(var i in a) s+= "<option value=\""+i+sep+a[i][0]+sep+a[i][1]+sep+"\">\n";
  document.getElementById("formulas").innerHTML = s;
  */

  //   _______     _       _____     ________  _________  _________  ________  
  //  |_   __ \   / \     |_   _|   |_   __  ||  _   _  ||  _   _  ||_   __  | 
  //    | |__) | / _ \      | |       | |_ \_||_/ | | \_||_/ | | \_|  | |_ \_| 
  //    |  ___/ / ___ \     | |   _   |  _| _     | |        | |      |  _| _  
  //   _| |_  _/ /   \ \_  _| |__/ | _| |__/ |   _| |_      _| |_    _| |__/ | 
  //  |_____||____| |____||________||________|  |_____|    |_____|  |________| 

 


  if(!bRefresh) oPALETTE.insert_canvas({"id":"mainPalette","canvasID":[0,1],"width":_D.leftpane+_D.rightpane,"height":_D.topheight});
  oPALETTE.hex_pal = [];
  for(var p=0;p<oPATTERN.pmax;p++)
  {
    var c = oPATTERN.color(p,apple2plus.video.hgr_PixelColor);    // calculate average color of patternID, by borrowing hgr_PixelColor function from emulator
    var csh = "#"+RGB2HEX(c).join("");
    oPALETTE.hex_pal[p] = csh;   // inventorize palette colors from every pattern
  }
  oPALETTE.dot_size=6;
  oPALETTE.color_depth=24;

 
  oPALETTE.opat = _D.opat;
  oPALETTE.draw_rainbow();
  // when progress done
  oPALETTE.progress_done = function()
  {
    document.getElementById("hourglass").style.visibility = "hidden";  // hide progress bar
    document.body.style.visibility = "visible";                         // reveal main screen
    update(true); // update rest of the screen
  }


  //oPALETTE.insert_canvas({"id":"greyPalette","canvasID":[2,3],"width":_D.leftpane,"height":50});
  //oPALETTE.draw_greyscale();




  //status_message("update");
  //setTimeout(function(){update(true)},1);
  //update(true);

  //oPALETTE.draw_colormatches(oPATTERN);
  //oPALETTE.draw_greymatches();
  
  //////   PALETTE MOUSE EVENTS (select circular area)
  oPALETTE.canvas[1].addEventListener('mousedown',
  function(event)
  {
      oPALETTE.mouseXY.x = event.offsetX;
      oPALETTE.mouseXY.y = event.offsetY;
      oPALETTE.bSelectMode = true;
  }
  ,false);

  oPALETTE.canvas[1].addEventListener('mousemove',
  function(event)
  {
    if(!oPALETTE.bSelectMode) return;

    oPALETTE.mouseXY.dx = event.offsetX-oPALETTE.mouseXY.x;
    oPALETTE.mouseXY.dy = event.offsetY-oPALETTE.mouseXY.y;
    var r = Math.sqrt(oPALETTE.mouseXY.dx*oPALETTE.mouseXY.dx + oPALETTE.mouseXY.dy*oPALETTE.mouseXY.dy)
    oPALETTE.clear_layer(1);
    oPALETTE.draw_colormatches(oPATTERN);
    oPALETTE.ctx[1].beginPath();
    oPALETTE.ctx[1].arc(oPALETTE.mouseXY.x, oPALETTE.mouseXY.y, r, -0.5*Math.PI, 1.5*Math.PI);
    oPALETTE.ctx[1].lineWidth=1;
    oPALETTE.ctx[1].strokeStyle = "#808080";
    oPALETTE.ctx[1].stroke();
  }
  ,false);

  oPALETTE.canvas[1].addEventListener('mouseup',
  function(event)
  {
      var dx = event.offsetX-oPALETTE.mouseXY.x;
      var dy = event.offsetY-oPALETTE.mouseXY.y;
      var r = Math.sqrt(dx*dx + dy*dy);

      var imageData = oPALETTE.ctx[0].getImageData(oPALETTE.mouseXY.x, oPALETTE.mouseXY.y, 1, 1).data;
      oPALETTE.bSelectMode = false;
      
      for(var i=0;i<oPALETTE.dec_near_col.length;i++)
      {
        var dxs = oPALETTE.dec_near_pos[i][0][0]-oPALETTE.mouseXY.x;
        var dys = oPALETTE.dec_near_pos[i][0][1]-oPALETTE.mouseXY.y;
        var rs = Math.sqrt(dxs*dxs + dys*dys);
        if(rs<r) oPALETTE.limit_dots[i] = true;
      }
      
      oPALETTE.clear_layer(1);
      oVoronoi.render();
      oPALETTE.draw_colormatches(oPATTERN);
      generate_GRIDS();
      generate_HGR();
  }
  ,false);  
  ////////////////////////////////
}

// ██████  ██████  ██ ██████  ███████ 
//██       ██   ██ ██ ██   ██ ██      
//██   ███ ██████  ██ ██   ██ ███████ 
//██    ██ ██   ██ ██ ██   ██      ██ 
// ██████  ██   ██ ██ ██████  ███████ 

// SHOW BITMAP TABLES (LEFT PANE)
function generate_GRIDS()
{
  // TODO : REPORT MOST APPROXIMATE COLOR MATCH + DISTANCE

  var im = "data:image/gif;base64,R0lGODlhAQABAPAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==";
  //var im = "../res/pixT.gif";
  var dot = ["<img src=\""+im+"\" style=\"width:9px;height:9px\" onclick=Cpix(this)>"
            ,"<img src=\""+im+"\" style=\"width:5px;height:9px\" onclick=Cpix(this)>"]

  // PARSE PATTERN FUNCTION - CASE BY CASE
  formula_ref = oPATTERN.parse(); //parse_FORMULA()

  s= "<big><font color=white>BITMAP GRIDS<font></big><br><br>";
  var pmax = oPATTERN.pmax;
  for(var p=0;p<pmax;p++)
  {
    var c = oPATTERN.color(p,apple2plus.video.hgr_PixelColor);    // calculate average color of patternID, by borrowing hgr_PixelColor function from emulator
    var csh = "#"+RGB2HEX(c).join("");
    var csp = [Math.round(100*c[0]/255),Math.round(100*c[1]/255),Math.round(100*c[2]/255)];
    var cc = oPATTERN.criteria[p];

    if(Object.keys(oPALETTE.limit_dots).length>0
          && oPALETTE.limit_dots[p]!=true) continue;  // RANGE SELECT CRITERIA
    if(Object.keys(oPALETTE.limit_dots).length!=1 
          && oPATTERN.test_criteria(p)) continue;     // PATTERN EXCLUSION CRITERIA

    var tc = csp[0]>90 && csp[1]>90 && csp[2]>90 ? "black":"white";

    s+= "<div style='width:430px;background-color:"+csh+";color:"+tc+";vertical-align:top; margin:4px 0px 0px 0px; overflow-wrap:anywhere;'><big>"+p+"</big> "
       +"<small>"+csh+" ("+csp.join("% ")+"%) sat:"+oPALETTE.colorSaturation(c)
       //+" "+oPALETTE.get_nearest(c,oPATTERN);
       //+(typeof(oPATTERN.citeria[p])!="undefined"?(" "+oPATTERN.citeria[p]):"")
       //+typeof(oPATTERN.criteria[p])
 
    if(cc)
    {
      s+=" ";
      for(var j in oPATTERN.criteria[p])
        if(oPATTERN.criteria[p][j]>=0) s+=j+":"+oPATTERN.criteria[p][j]+" "; else s+= j+" ";
    }

    s+="</small>"
    s+= formula_ref[p]?("<br>"+formula_ref[p]):"";
    s+="</div>"
    s+= "<table style='margin:0;padding:0;border:1px solid "+(p==_D.bmapID?"red":"black")+";'>";
    for(var y=0;y<oPATTERN.bmapy;y++)
    {
      s+="<tr>";
      for(var x=0;x<oPATTERN.bmapx;x++) s+= gen_cell(p,x,y,p==_D.bmapID?dot:["",""]);
      s+="</tr>";
    }
    s+="</table>";
  }  
  s+="<br><br><br><br><br><br>";
  document.getElementById("debug").innerHTML = s;
}

function gen_cell(patternID,x,y,img)
{
  var c = oPATTERN.calculate(patternID,x,y);
  var bi = isNaN(patternID); 
  var alt = "", css = ""

/*
  // CLICK GRID CELL
  if(patternID == _D.bmapID)
  {
    var left = x<=0 ? false : custom_bmap[x-1][y][0];
    var me = custom_bmap[x][y][0];
    var right = x>=(oPATTERN.bmapx-1) ? false : custom_bmap[x+1][y][0];
    var b7 = custom_bmap[x][y][1]==128?1:0;
    //var col = hgr_PixelColor_HGR(x, y, left, me, right, b7)
    //var alt = "<span class=tooltiptext style=color:"+col+";font-size:8px>"+col+"("+[left,me,right,b7].join(",")+")</span>";
    var css = "tooltip "
    var alt = "";
  }
*/

  var pix = c[0]?"background-color:black":"";
  var bck = (c[1]==128?"border-color:#FFE9D0":"");
  var s= "<td class='"+css+"tcell10' alt=\""+alt+"\" style=\""+pix+";padding:0;"+bck+"\">"+img[0].replace(/this/g,"this,"+x+","+y+",0")+alt+"</td>"
  if((x+1)%7==0)
    s+= "<td class=tcell5 style=\""+(c[1]==128?"background-color:black":"")+"\">"+img[1].replace(/this/g,"this,"+x+","+y+",1")+"</td>"
  return s;
}

function load_bitmap()
{
  var sep = " ; "
  var sel = document.getElementById("FSL").value.split(sep);
  custom_fmla[0] = sel[1];
  custom_fmla[1] = sel[2];

  // FILL custom_bmap using custom_fmla
  for(var y=0;y<oPATTERN.bmapy;y++)
  {
    for(var x=0;x<oPATTERN.bmapx;x++) 
      custom_bmap[x][y] = [eval(custom_fmla[0]),eval(custom_fmla[1])];
  }
  generate_GRIDS();
}

function Cpix(t,x,y,z)
{ 
  if(z==0)
    custom_bmap[x][y] = [ custom_bmap[x][y][0]?false:true, custom_bmap[x][y][1]];
  else
  {
     for(var i=x;i>(x-7);i--)
        custom_bmap[i][y] = [ custom_bmap[i][y][0], custom_bmap[i][y][1]==0?128:0];
  }
  var o=t.parentNode.style; o.backgroundColor=o.backgroundColor?"":"green";
}

//██████  ███████ ██████   ██████  ██████  ████████ 
//██   ██ ██      ██   ██ ██    ██ ██   ██    ██    
//██████  █████   ██████  ██    ██ ██████     ██    
//██   ██ ██      ██      ██    ██ ██   ██    ██    
//██   ██ ███████ ██       ██████  ██   ██    ██    
                                                
function generate_REPORT(arg)
{
  // PARSE PATTERN FUNCTION - CASE BY CASE
  //formula_ref = oPATTERN.parse(); //parse_FORMULA()
  copyTextToClipboard(oPATTERN.export_json(arg));
}

function fallbackCopyTextToClipboard(text) 
{
  var textArea = document.createElement("textarea");
  textArea.value = text;
  
  // Avoid scrolling to bottom
  textArea.style.top = "0";
  textArea.style.left = "0";
  textArea.style.position = "fixed";

  document.body.appendChild(textArea);
  textArea.focus();
  textArea.select();

  try {
    var successful = document.execCommand('copy');
    var msg = successful ? 'successful' : 'unsuccessful';
    console.log('Fallback: Copying text command was ' + msg);
  } catch (err) {
    console.error('Fallback: Oops, unable to copy', err);
  }

  document.body.removeChild(textArea);
}

function copyTextToClipboard(text)
{
  if (!navigator.clipboard) {
    fallbackCopyTextToClipboard(text);
    return;
  }
  navigator.clipboard.writeText(text).then(function() {
    console.log('Async: Copying to clipboard was successful!');
  }, function(err) {
    console.error('Async: Could not copy text: ', err);
  });
}
                                                      
//██   ██  ██████  ██████  
//██   ██ ██       ██   ██ 
//███████ ██   ███ ██████  
//██   ██ ██    ██ ██   ██ 
//██   ██  ██████  ██   ██ 

function generate_HGR()
{ 
  wipe_HGR(0);
  var spc = [11,11];
  var ofs = [-5,-4];

  var pmax = oPATTERN.pmax;
  for(var p=_D.opat,dx=0,dy=0;p<pmax;p++)
  {
    var c = oPATTERN.color(p,apple2plus.video.hgr_PixelColor);    // calculate average color of patternID, by borrowing hgr_PixelColor function from emulator
    var csh = "#"+RGB2HEX(c).join("");
    var cc = oPATTERN.criteria[p];

    if(Object.keys(oPALETTE.limit_dots).length>0
          && oPALETTE.limit_dots[p]!=true) continue; // RANGE SELECT CRITERIA
    if(Object.keys(oPALETTE.limit_dots).length!=1 
          && oPATTERN.test_criteria(p)) continue;    // PATTERN EXCLUSION CRITERIA

    // DRAW LINE SQUARE
    for(var x=-3;x<_D.bls[0]+3;x++)
    {
      //setPixel_HGR(ofs[0]+x+spc[0]+dx*(_D.bls[0]+spc[0]),ofs[1]-4+spc[1]+dy*(_D.bls[1]+spc[1]));
      //setPixel_HGR(ofs[0]+x+spc[0]+dx*(_D.bls[0]+spc[0]),ofs[1]-3+spc[1]+dy*(_D.bls[1]+spc[1]));
      setPixel_HGR(ofs[0]+x+spc[0]+dx*(_D.bls[0]+spc[0]),ofs[1]+_D.bls[1]+2+spc[1]+dy*(_D.bls[1]+spc[1]));
      setPixel_HGR(ofs[0]+x+spc[0]+dx*(_D.bls[0]+spc[0]),ofs[1]+_D.bls[1]+3+spc[1]+dy*(_D.bls[1]+spc[1]));
    }
    for(var y=-3;y<_D.bls[1]+3;y++)
    {
      setPixel_HGR(ofs[0]-4+spc[0]+dx*(_D.bls[0]+spc[0]),ofs[1]+y+spc[1]+dy*(_D.bls[1]+spc[1]));
      setPixel_HGR(ofs[0]-3+spc[0]+dx*(_D.bls[0]+spc[0]),ofs[1]+y+spc[1]+dy*(_D.bls[1]+spc[1]));
      setPixel_HGR(ofs[0]+_D.bls[0]+2+spc[0]+dx*(_D.bls[0]+spc[0]),ofs[1]+y+spc[1]+dy*(_D.bls[1]+spc[1]));
      setPixel_HGR(ofs[0]+_D.bls[0]+3+spc[0]+dx*(_D.bls[0]+spc[0]),ofs[1]+y+spc[1]+dy*(_D.bls[1]+spc[1]));
    }          

    // DRAW PATTERN SQUARE
    for(var y=0;y<_D.bls[1];y++)
        for(var x=0;x<_D.bls[0];x++)
            patPixel_HGR(ofs[0]+x+spc[0]+dx*(_D.bls[0]+spc[0]),ofs[1]+y+spc[1]+dy*(_D.bls[1]+spc[1]),p);

    // DRAW NUMBERS
    //clearPixel_HGR(-3+spc[0]+dx*(_D.bls[0]+spc[0]),ofs[1]+0+spc[1]+dy*(_D.bls[1]+spc[1]),"");
    var ddx = ofs[0]+spc[0]+dx*(_D.bls[0]+spc[0])-5;
    var ddy = ofs[1]+spc[1]+dy*(_D.bls[1]+spc[1])-5;
    clearPixel_HGR(ddx+1,ddy+4);
    clearPixel_HGR(ddx+2,ddy+4);
    clearPixel_HGR(ddx+1+_D.bls[0]+6,ddy+2);
    clearPixel_HGR(ddx+1+_D.bls[0]+7,ddy+2);
    clearPixel_HGR(ddx+1+_D.bls[0]+6,ddy+3);
    clearPixel_HGR(ddx+1+_D.bls[0]+7,ddy+3);

    if(cc && !cc["DOUBL"])      // EXCLUDED
    {
      draw_number(12,[ddx,ddy-1]);
      ddx+=6;
      var digits = p.toString(10);
      for(var c=0;c<digits.length;c++)
        draw_number(Number(digits[c]),[ddx+c*6,ddy-1])      
    }
    else if(cc && cc["DOUBL"])   // DOUBLE
    {
      draw_number(11,[ddx,ddy-1]);
      ddx+=6;
      var digits = p.toString(10);
      //var digits = cc["DOUBL"].toString(10);
      for(var c=0;c<digits.length;c++)
        draw_number(Number(digits[c]),[ddx+c*6,ddy-1])
    }
    else                        // NORMAL
    {
      var digits = p.toString(10);
      for(var c=0;c<digits.length;c++)
        draw_number(Number(digits[c]),[ddx+c*6,ddy-1])
    }

    if(oPATTERN.is_2x2(p)) draw_number(10,[ddx+c*6,ddy-1]);   // detect 2x2 patterns
    if(dx==_D.blc[0]-1) dx=0; else { dx++; continue; }  // x coordinate positioning
    if(dy==_D.blc[1]-1) break; else dy++;               // y coordinate positioning
  }
}

/////////////////////////////////////////////////////////
// CALL FUNCTIONS

function draw_number(num,pos)
{
  var numberfont = 
  [
   ["01110","00110","01110","11110","00111","11111","01111","11111","01110","01110","11011","00000","10001"]
  ,["11011","01110","11011","00011","01111","11000","11000","00011","11011","11011","01110","00101","00100"]
  ,["11011","00110","00110","01110","11011","11110","11110","00110","01110","01111","11011","10100","00100"]
  ,["11011","00110","01100","00011","11111","00011","11011","01100","11011","00110","00000","00101","00100"]
  ,["01110","01111","11111","11110","00011","11110","01110","11000","01110","01100","00000","00000","10001"]
  ]

  // DRAW NUMBER
  for(var x=0;x<5;x++)
    for(var y=0;y<5;y++)
    {
        if(numberfont[y][num].charAt(x)=="1") setPixel_HGR(x+pos[0],y+pos[1],128);
        else clearPixel_HGR(x+pos[0],y+pos[1],128);
        clearPixel_HGR(x+1+pos[0],y+pos[1],128);
        clearPixel_HGR(x+2+pos[0],y+pos[1],128);
    }
}

function Apple2Plus(context)
{
  this.video = new Apple2Video(context);
  this.hw    = new Apple2Hw(this.video);
  // Switch on Apple II Hi-Res graphics
  this.video.reset();
  this.video.setGfx(true);
  this.video.setHires(true);
  this.video.redraw();
}

var hextab= ['0','1','2','3','4','5','6','7','8','9','A','B','C','D','E','F']; 
function getHexByte(v) { return hextab[v>>4]+hextab[v&0xf] }
//function HEX2RGB(hex) { var n=parseInt(hex.slice(1),16); return [(n>>16)&0xFF,(n>>8)&0xFF,n&0xFF] }
function RGB2HEX(dec) { return [getHexByte(dec[0]),getHexByte(dec[1]),getHexByte(dec[2])] }

function patPixel_HGR(x,y,patternID)
{
    // find address and bit location
    var adr = yref[y] + Math.floor(x/7);              // find address 
    var rbyt = apple2plus.hw.read(adr);               // read byte
    var wbyt = oPATTERN.pixel(x,y,patternID,rbyt)
    apple2plus.hw.write(adr,wbyt);                    // write byte 
}

function setPixel_HGR(x,y,h)
{
    // find address and bit location
    var adr = yref[y] + Math.floor(x/7);              // find address 
    var rbyt = apple2plus.hw.read(adr);
    var wbyt = rbyt | (1 << x%7) | (h?h:0);
    apple2plus.hw.write(adr,wbyt);                    // write byte 
}

function clearPixel_HGR(x,y,h)
{
    // find address and bit location
    var adr = yref[y] + Math.floor(x/7);              // find address 
    var rbyt = apple2plus.hw.read(adr);
    var wbyt = rbyt & ~(1 << x%7) & 127 | (h?h:0);              // AND current bit with pixel bit
    apple2plus.hw.write(adr,wbyt);                    // write byte 
}

function getPixel_HGR(x,y)
{
    // find address and bit location
    var adr = yref[y] + Math.floor(x/7);              // find address 
    var rbyt = apple2plus.hw.read(adr);
    var bit = (rbyt >> (x%7)) & 1 == 1;
    bit = x<0 || x>279 ? 0 : bit;                     
    var b7  = rbyt & 128;
    return [ bit,b7 ]
}

function wipe_HGR(byte)
{
    for(var adr=8192;adr<16384;adr++)
    apple2plus.hw.write(adr,byte);                      // write byte 
}

//  ██    ██  ██████  ██████   ██████  ███    ██  ██████  ██ 
//  ██    ██ ██    ██ ██   ██ ██    ██ ████   ██ ██    ██ ██ 
//  ██    ██ ██    ██ ██████  ██    ██ ██ ██  ██ ██    ██ ██ 
//   ██  ██  ██    ██ ██   ██ ██    ██ ██  ██ ██ ██    ██ ██ 
//    ████    ██████  ██   ██  ██████  ██   ████  ██████  ██

var oVoronoi = 
{
  voronoi: new Voronoi(),
  sites: [],
  bbox: {xl:0,xr:_D.leftpane+_D.rightpane,yt:0,yb:_D.topheight},

  init: function(canvasID) {  this.canvas = document.getElementById(canvasID); this.sites = [] },

  addSite: function(coord) {
      // create vertices
          this.sites.push({
              x: coord[0],
              y: coord[1]
              });
      },

  compute: function(xc,yc) {
      this.voronoi.recycle(this.diagram);
      this.diagram = this.voronoi.compute(this.sites, this.bbox);
    },

  render: function() {
      var _ctx = this.canvas.getContext('2d');
      if (!this.diagram) return;

      // voronoi edges
      _ctx.beginPath();
      _ctx.lineWidth = 2;
      _ctx.strokeStyle = '#FFF';
      var edges = this.diagram.edges,
          iEdge = edges.length,
          edge, v;
      while (iEdge--) {
          edge = edges[iEdge];
          v = edge.va;
          _ctx.moveTo(v.x,v.y);
          v = edge.vb;
          _ctx.lineTo(v.x,v.y);
          }
      _ctx.stroke();
      }
}

//  ██    ██ ██████  ██████   █████  ████████ ███████ 
//  ██    ██ ██   ██ ██   ██ ██   ██    ██    ██      
//  ██    ██ ██████  ██   ██ ███████    ██    █████   
//  ██    ██ ██      ██   ██ ██   ██    ██    ██      
//   ██████  ██      ██████  ██   ██    ██    ███████

function update(bRender)
{
  setTimeout(function(){status_message("update")},10);
  document.getElementById("param3").max = oPALETTE.hex_pal.length-1;      // set slider range
  //oPATTERN.filterExcl=document.getElementById('param5').value==1;         // set filter

  if(document.getElementById("param3"))
  {
      var dot_idx   = Number(document.getElementById("param3").value);
      oPALETTE.limit_dots = {}
      if(dot_idx>=0) oPALETTE.limit_dots[dot_idx] = true;
      else dot_idx = "";
      document.getElementById("disp_param3").innerHTML 
      ="<font color=black>dot select "+dot_idx+"</font>"
  }

  if(document.getElementById('param4'))
  {
      var num = Number(document.getElementById('param4').value);
      if(num<0) num = 0;
      document.getElementById('param4').value = num;
      _D.opat = num * ( _D.blc[0]*_D.blc[1] )
  }

  var checkboxes = document.getElementsByName("param6"); 
  oPATTERN.filterExcl = []
  for(var i = 0; i < checkboxes.length; i++)  
      if(checkboxes[i].checked) oPATTERN.filterExcl[oPATTERN.filterExcl.length] = checkboxes[i].value;
  
  var checkboxes = document.getElementsByName("param7"); 
  for(var i = 0; i < checkboxes.length; i++)  
      if(checkboxes[i].checked) oPATTERN.set_prep( Number( checkboxes[i].value));

  //alert("'"+oPATTERN.filterExcl.join("','")+"'")

  oVoronoi.init(oPALETTE.canvas[1].id);
  for(var p=0;p<oPALETTE.dec_near_col.length;p++)
  {
    if(!oPALETTE.dec_near_pos[p][0][0]) continue;   // NOT DISPLAYABLE
    var cc = oPATTERN.criteria[p];
    if(oPATTERN.test_criteria(p)) continue;   // PATTERN EXCLUSION CRITERIA
    oVoronoi.addSite(oPALETTE.dec_near_pos[p][0]);
  }
  oVoronoi.compute();

  if(!bRender) return;
  oPALETTE.clear_layer(1);
  oVoronoi.render();
  oPALETTE.draw_colormatches(oPATTERN);
  generate_GRIDS();
  generate_HGR();

  setTimeout(function(){status_message("done")},10);
}

//  ██   ██ ████████ ███    ███ ██      
//  ██   ██    ██    ████  ████ ██      
//  ███████    ██    ██ ████ ██ ██      
//  ██   ██    ██    ██  ██  ██ ██      
//  ██   ██    ██    ██      ██ ███████ 


var CONF_version="";
var CONF_builddate="";  
var _T = function _T(idx,mod) {
this.t = {get _language(){ return "NL" }
,"title":document.title
,"menu_convert":""
,"menu_info":"Info/Contact"
,"intro":""
,"version":(CONF_version?("Version "+CONF_version):"")
,"built":(CONF_builddate?("Built "+CONF_builddate):"")
,get _(){return this}
}
if(idx.length>0 && typeof(this.t[idx])=="undefined") { alert(idx); return "<font color=red>"+idx+"</font>" }
switch(mod) {
  case "cap": return this.t[idx].charAt(0).toUpperCase()+this.t[idx].substring(1,this.t[idx].length);
  case "inv": { var j = {}; for(var i in t) { j[ t[i] ] = i }; return j } // inverse associative
  default: return this.t[idx];
}
}
function _D(idx) { if(typeof(_T(idx)=="string")) document.write(_T(idx)) }
function _TITLE() {
var hight_pct = 6;
var css = "#texturespace {background: #f7f7f7 url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAAEEAYAAAD5YUI9AAAACXBIWXMAAA4mAAAOJgGi7yX8AAAARElEQVQIHWPYyrxTed9eg3UQWkQHQgtaQGg5JgaohAdUoglC8z+A0mFQBYIpUIEXULoOQgvIQRXIBUElMqASShBaWQwApNg4NPAzQGwAAAAASUVORK5CYII=') repeat center top;font: 62.5%/1 sans-serif;height: 100%;width: 100%;}"
+"#carvetext {color: transparent;background: #f7f7f7;font: 62.5%/1 sans-serif;stroke: 2px rgba(0,0,0,0.2);background-color: rgba(140,140,140,1);-webkit-background-clip: text;text-shadow: rgba(255,255,255,0.5) 0 5px 6px, rgba(255,255,255,0.2) 1px 3px 3px;transition: text-shadow .1s ease-out, background-color .2s ease-out;}"
+"#carvetext:hover {color: transparent;background-color: rgba(82,96,117,0.5);-webkit-background-clip: text;text-shadow: rgba(255,255,255,0.5) 0 5px 6px;}"
+"#carvetext:focus {outline: none;}.slider_main {position: relative;height: 100%;}"
+".slider_overlay {position: absolute;bottom: 0;left: 0;right: 0;background-color: #A0A0A0;overflow: hidden;width: 100%;height: 85%;transition: .5s ease;}"
//+".slider_main:hover "
+".slider_overlay {height: 100%;}"
+"#topmenu{width:100%;background-color:#f0f0f0}"
+"ul#minitabs{list-style:none;margin:0;padding:3px 0 0 0;border-left:1px solid #ccc;border-right:1px solid #ccc;border-top:1px solid #ccc;border-bottom:1px solid #ccc;font-weight:700;text-align:left;white-space:nowrap}ul#minitabs li{display:inline;margin:0 3px}ul#minitabs a{text-decoration:none;color:#999}ul#minitabs a#current{border-color:#f60;color:#06f}ul#minitabs a:hover{border-color:#f60;color:#666}"

return "<style>"+css+".slider_overlay{height: "+(100-hight_pct)+"%}</style>"
+"<div id=texturespace style='height:100%;width:100%'><center><div id='carvetext'>"
+"<div style='font-size:5em'>"+(typeof(_T("title"))=="string"?_T("title"):"")+"</div>"
+"<div style='font-size:1em'>"+(typeof(_T("version"))=="string"?_T("version"):"")
+" &nbsp; "+(typeof(_T("built"))=="string"?_T("built"):"")+"</div>"
+"</div></center></div>"
}
</script>

  <title>APPLE II HGR PATTERN GENERATOR</title>
  <meta name="description" content="">
  <meta name="author" content="Freddy Vandriessche">
  <meta charset="utf-8">
  <style>
  html {height:100%;font-family:"Arial"}
  body {background-color:#808080;height:100%;margin:0px;padding:0px}
  .tcell10 {width:10px;height:10px;background-color:white;padding:0;border:1px solid white}
  .tcell10:hover {width:10px;height:10px;background-color:yellow;border:1px solid black }
  .tcell5 {width:5px;height:10px;background-color:lightgray;padding:0;border:0px solid white}
  .tcell5:hover { width:5px;height:10px;background-color:yellow;border:0px solid white}
  .slider {display:inline-block; margin:0px 0px 0px; padding:0px 0px 0px 0px 0px;}
  .smallbutton {width:15px;height:5px;font-size:12px;vertical-align:top;margin:3px 0px 0px 0px;padding:0px 0px 0px 0px;font-weight:800}
  .leftpane {width:400px}
  #MyCanvas {border:1px solid black}
  .no_margins { margin:0px 0px 0px; padding:0px 0px 0px 0px 0px; border:0px solid; }

  .tooltip { position: relative; display: inline-block; border-bottom: 1px dotted black; }
  .tooltip:hover .tooltiptext { visibility: visible; }
  .tooltip .tooltiptext {
  visibility: hidden;
  width: 120px;
  background-color: black;
  color: #fff;
  text-align: center;
  border-radius: 6px;
  padding: 5px 0;
  position: absolute;
  z-index: 1;
  }
  </style>
</head>

<body class="slider_main" onload="oPALETTE.progress_bar(0);setTimeout(init_gui, 100);" style="visibility:hidden;">
<div id="slider_title"></div>
 <div class="slider_overlay">
    <div id="topmenu">
      <ul id="minitabs">

        <li class=no_margins style=vertical-align:top;>
          <table class=nomargins style="display:inline-block;vertical-align:top">
          <tr>
            <td class=no_margins style="vertical-align:top;">
              <div id=disp_param3 class="slider" style="width:100px;vertical-align:top"></div>
              <small>pattern </small>
              <input type="radio" name=param7 value=2 onchange="setTimeout(function(){update(false);init_gui(true)},10)" style='margin:0px 0px 0px; padding:0px 0px 0px 0px 0px;'><small>2</small>
              <input type="radio" name=param7 value=4 onchange="setTimeout(function(){update(false);init_gui(true)},10)" style='margin:0px 0px 0px; padding:0px 0px 0px 0px 0px;' checked><small>4</small>
              <input type="radio" name=param7 value=6 onchange="setTimeout(function(){update(false);init_gui(true)},10)" style='margin:0px 0px 0px; padding:0px 0px 0px 0px 0px;'><small>6</small> bit
              <input type=button value="next" onclick="document.getElementById('param4').value++;update();generate_HGR();document.getElementById('FSL').focus();" style='vertical-align:top; float: right;  margin:0px 0px 0px 0px'>
              <input type=button value="prev" onclick="document.getElementById('param4').value--;update();generate_HGR();document.getElementById('FSL').focus();" style='vertical-align:top; float: right; margin:0px 0px 0px 0px'>
              </td></tr></tr><td>
              <input type=image  src=../res/arrow_button_left.png onclick="document.getElementById('param3').value--;update(true);">
              <input type="range" min="-1" max="0" value="-1" class="slider" id="param3" step=1 style="width:280px;height:20px;margin:0px 0px 0px 0px;" oninput="update();oPALETTE.clear_layer(1);oVoronoi.render();oPALETTE.draw_colormatches(oPATTERN);generate_GRIDS();generate_HGR();">
              <input type=image  src=../res/arrow_button_right.png onclick="document.getElementById('param3').value++;update();oPALETTE.clear_layer(1);oVoronoi.render();oPALETTE.draw_colormatches(oPATTERN);generate_GRIDS();generate_HGR();">
          </td>
        </tr>
        </table>    
        </li>
        <li class=no_margins>
          <table style='display:inline-block;border:1px solid; vertical-align: top;'>
          <tr>
            <td><input type="checkbox" name=param6 value=DOUBL onclick=update(true) style='margin:0px 0px 0px; padding:0px 0px 0px 0px 0px;'><small> double</small></td>
            <td><input type="checkbox" name=param6 value=PROX onclick=update(true) style='margin:0px 0px 0px; padding:0px 0px 0px 0px 0px;'><small> too close</small></td>
            <td><input type="checkbox" name=param6 value=VPAT onclick=update(true) style='margin:0px 0px 0px; padding:0px 0px 0px 0px 0px;'><small> dirty</small></td>
          </tr>
          <tr>
            <td><input type="checkbox" name=param6 value=SAT onclick=update(true) style='margin:0px 0px 0px; padding:0px 0px 0px 0px 0px;'><small> saturation</small></td>
            <td><input type="checkbox" name=param6 value=GREY onclick=update(true) style='margin:0px 0px 0px; padding:0px 0px 0px 0px 0px;'><small> greyscale</small></td>
            <td><input type="checkbox" name=param6 value="REG" onclick=update(true)  checked style='margin:0px 0px 0px; padding:0px 0px 0px 0px 0px;'><small> regular</small></td>
          </tr>         
          </table>
        </li>
        <!--li>
          <input autofocus style=width:430px list="formulas" name="formula-selector" id="FSL" value="select a pattern here" onclick=this.value='' />
          <datalist id="formulas" ></datalist>
        </li-->
        <!--li><input type=button value="load" onclick="load_bitmap();document.getElementById('FSL').focus()" style='vertical-align:top; margin:4px 0px 0px 0px'></li-->
        <li class=no_margins><img style='vertical-align:top; margin:15px 0px 0px 0px' src='data:image/gif;base64,R0lGODlhGAAYAPAAAF3/AAAAACH5BAEAAAAALAAAAAAYABgAAAJPhG+hiu0Y4JsnSvqsBRvXtHXVQmpM4ogN+V1T2aJcSZ9cW+c4mNOf2fOBeEHWcFZc/IjFHbIpu1FgUelLWX1SsVaPKeaRhsKubLijOhspBQA7'></li>
        <!--li><input type=button value="Generate_HGR" onclick="document.getElementById('FSL').focus();oPALETTE.draw_rainbow();update(true);" style='vertical-align:top; margin:4px 0px 0px 0px'></li-->
        <li class=no_margins>
          <div class=no_margins style="display:inline-block;">
          <div class=no_margins id=status></div>
          <input type=button value="Copy_Lim_Report" onclick="generate_REPORT({'filter':'exclude_all_criteria'})" style='margin:0px 0px 0px; padding:0px 0px 0px 0px 0px;'>
          <br>
          <input type=button value="Copy_Full_Report" onclick="generate_REPORT()" style='margin:0px 0px 0px; padding:0px 0px 0px 0px 0px;'>
           </div>
        </li>
        <li>
          <input id=param4 value=0 hidden>
          <input id=param5 value=1 hidden>
        </li>
      </ul>
    </div>
    <div id=main>
    <div id=hourglass style="position:absolute;top:0;left:0;z-index:1;visibility:visible;"></div>
    <table><tr>
      <td style="vertical-align:top">
        <div id=mainPalette></div>
        <!--div id=greyPalette style="margin-top:150px"></div-->
        <div id="results" style="margin-top:220px"></div>   
        <div id=debug style="overflow:scroll; height:400px;"></div>
      </td>
      <td style=vertical-align:top;>
        <canvas class="appvid" id="applescreen" width="560" height="384"></canvas>
      </td>
    </tr></table>

  </div>
  </div>
</body>
<footer><small><a href=https://raw.githubusercontent.com/RetroAppleJS/AppleII-IDE/main/LICENSE.md>Copyright (c) 2022, Freddy Vandriessche</a></small></footer>
</html>