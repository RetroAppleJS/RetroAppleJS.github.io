<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>AsciiCAD (Wrapper)</title>
    <style>
html, body { height: 100%; margin: 0; }
body {
  overflow: hidden;
  display: flex;
  flex-direction: column;
  height: 100vh;
}

.topbar{
  height: 40px;
  flex: 0 0 40px;
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 0 10px;
  font: 12px system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
  color: #ddd;
  background: #1b1b1b;
  border-bottom: 1px solid #2a2a2a;
  box-sizing: border-box;
}

.frame{
  flex: 1 1 auto;
  width: 100%;
  border: 0;
  display: block;
  background: #fff;
}

#logPanel{
  flex: 0 0 140px;
  height: 140px;
  overflow-y: auto;
  overflow-x: hidden;
  background: #0f172a;
  color: #e5e7eb;
  font: 12px ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
  padding: 6px;
  margin: 0;
  border-top: 1px solid #334155;
  box-sizing: border-box;
  white-space: pre-wrap;
}

    </style>
  </head>
  <body>
    <div class="topbar">
      <button id="openNewTab">Open AsciiCAD</button>
      <button id="reloadIframe">Hard Reload</button>
      <button onclick="logPanel.textContent=''">Clear Logs</button>
      <span>
        Source:
        <a id="srcLink" href="https://raw.githubusercontent.com/RetroAppleJS/RetroAppleJS.github.io/refs/heads/main/tools/GUI_DEV/AsciiCAD.html" target="_blank" rel="noopener">AsciiCAD.html</a>
      </span>
    </div>

    <iframe
      id="app"
      class="frame"
      src="AsciiCAD.html"
      title="AsciiCAD"
      sandbox="allow-scripts allow-downloads allow-pointer-lock allow-same-origin allow-popups allow-popups-to-escape-sandbox"
    ></iframe>

<div id="logPanel"></div>

<script>
  const baseURL = "AsciiCAD.html";
  const iframe = document.getElementById("app");
  const logPanel = document.getElementById("logPanel");

  // FORCE readable colors even if CSS is overridden
  logPanel.style.background = "#0f172a";
  logPanel.style.color = "#e5e7eb";
  logPanel.style.fontFamily = 'ui-monospace, SFMono-Regular, Menlo, Consolas, monospace';
  logPanel.style.fontSize = "12px";

  function loadFresh() {
    iframe.src = baseURL + "?t=" + Date.now();
  }

    window.addEventListener("message", (e) => {
    if (!e.data || !e.data.__asciicadLog) return;

    const line = document.createElement("div");
    line.style.whiteSpace = "pre-wrap";
    line.style.color =
        e.data.type === "error" ? "#f87171" :
        e.data.type === "warn"  ? "#fde047" : "#e5e7eb";

    line.textContent = `[${e.data.type}] ${(e.data.args || []).join(" ")}`;
    logPanel.appendChild(line);

    // Most reliable autoscroll:
    line.scrollIntoView({ block: "end" });
    });

  // hook up your buttons as you already did...
</script>

  </body>
</html>
