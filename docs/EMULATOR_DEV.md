## EMULATOR developers instructions

**color mode**

When the palette button is clicked, the following function is called 

[index.html](/index.html)
```javascript
var datastructure = apple2plus.monitor(this.name) // this.name = integer number cyling between 0-3
```

[EMU_apple2plus.js](/res/EMU_apple2plus.js)
```javascript
this.monitor = function(type) {
      return video.setMonitor(type);
}
```
[EMU_apple2video.js](/res/EMU_apple2video.js)
```javascript
this.setMonitor = function(mode) {
    chrome_mode = mode & 3;
    this.redraw();
    return {
         "color": _CFG_CHROMA[chrome_mode].COL_num?_CFG_CHROMA[chrome_mode].COL_num:"#000000"
        ,"name": _CFG_CHROMA[chrome_mode].COL_name
    };
}
```

Config file is generated from following markdown file: [CONFIG.md](/docs/CONFIG.md)

[COM_CONFIG.js](/res/COM_CONFIG.js)
```javascript
const _CFG_CHROMA = {
 0:{"COL_num":"" ,"COL_name":"FULL-COLOR"}
,1:{"COL_num":"#FFFFFF" ,"COL_name":"B&W"}
,2:{"COL_num":"#A0FFF0" ,"COL_name":"GREEN"}
,3:{"COL_num":"#FCE7A1" ,"COL_name":"AMBER"}
}
```

The physical screen output color is calculated here:

[EMU_apple2video.js](/res/EMU_apple2video.js)
```javascript

const INTCols = new Uint8Array([
0X00,0X00,0X00,0X0,0x00,0x00,0x00,0x0,0x00,0x00,0x00,0x0,0x00,0x00,0x00,0x0  // Black       * color 0 & 4
,0X90,0X17,0X40,0X0,0x4D,0x4D,0x4D,0x0,0x30,0x4D,0x48,0x0,0x4C,0x46,0x31,0x0  // Magenta
,0X40,0X2C,0XA5,0X0,0x5B,0x5B,0x5B,0x0,0x39,0x5B,0x56,0x0,0x5A,0x52,0x39,0x0  // Dark Blue
,0XD0,0X43,0XE5,0X0,0xA8,0xA8,0xA8,0x0,0x69,0xA8,0x9E,0x0,0xA6,0x98,0x6A,0x0  // Purple      * color 2
,0X00,0X69,0X40,0X0,0x38,0x38,0x38,0x0,0x23,0x38,0x35,0x0,0x38,0x33,0x24,0x0  // Dark Green
,0X80,0X80,0X80,0X0,0x80,0x80,0x80,0x0,0x50,0x80,0x78,0x0,0x7E,0x74,0x51,0x0  // Grey 1
,0X2F,0X95,0XE5,0X0,0x8E,0x8E,0x8E,0x0,0x59,0x8E,0x85,0x0,0x8C,0x80,0x59,0x0  // Medium Blue * color 6
,0XBF,0XAB,0XFF,0X0,0xCE,0xCE,0xCE,0x0,0x81,0xCE,0xC2,0x0,0xCB,0xBA,0x82,0x0  // Light Blue
,0X40,0X54,0X00,0X0,0x31,0x31,0x31,0x0,0x1F,0x31,0x2E,0x0,0x31,0x2D,0x1F,0x0  // Brown
,0XD0,0X6A,0X1A,0X0,0x71,0x71,0x71,0x0,0x47,0x71,0x6B,0x0,0x70,0x67,0x48,0x0  // Orange      * color 5
,0X80,0X80,0X80,0X0,0x80,0x80,0x80,0x0,0x50,0x80,0x78,0x0,0x7E,0x74,0x51,0x0  // Grey 2
,0XFF,0X96,0XBF,0X0,0xC7,0xC7,0xC7,0x0,0x7D,0xC7,0xBB,0x0,0xC4,0xB4,0x7D,0x0  // Pink
,0X2F,0XBC,0X1A,0X0,0x57,0x57,0x57,0x0,0x37,0x57,0x52,0x0,0x56,0x4F,0x37,0x0  // Light Green * color 1
,0XBF,0XD3,0X5A,0X0,0xA4,0xA4,0xA4,0x0,0x67,0xA4,0x9A,0x0,0xA2,0x95,0x68,0x0  // Yellow  
,0X6F,0XE8,0XBF,0X0,0xB2,0xB2,0xB2,0x0,0x70,0xB2,0xA8,0x0,0xB0,0xA1,0x70,0x0  // Aquamarine
,0XFF,0XFF,0XFF,0X0,0xFF,0xFF,0xFF,0x0,0xA0,0xFF,0xF0,0x0,0xFC,0xE7,0xA1,0x0  // White       * color 3 & 7
]);
var ColNames = ["Black","Magenta","Dark Blue","Purple","Dark Green","Grey 1","Medium Blue","Light Blue","Brown","Orange","Grey 2","Pink","Light Green","Yellow","Aquamarine","White"];


this.hgr_PixelColor = function(x, y, l, m, r, b7) 
{
  const chr = 0;
  const b   = x<<4 | l<<3 | (m<<2 | m<<1)&4 | (r<<1 | r>>1)&2 | b7>>7;
  const col =  0xF4E0F8D0>>>b &1 | 0x08200820>>>b-1 &2 | 0xF0D0F4C0>>>b-2 &4;
  const ofs = (col<<4)+(col<<5) | chr<<2;
  const a   = INTCols.slice(ofs,ofs+3);
  return "#"+RGB2HEX(a).join("");
}
```
